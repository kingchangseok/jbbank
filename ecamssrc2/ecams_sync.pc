/*--------------------------------------------------------------
 ┌──────┬───────────────────────┐
 │ 프로그램명 │ ecams_sync.pc                                │
 ├──────┼───────────────────────┤
 │ 기      능 │ 형상관리의 버전소스 동기화                   │
 ├──────┼───────────────────────┤
 │ 작  성  일 │ 2011. 10. 25                                 │
 ├──────┼───────────────────────┤
 │ 작  성  자 │ 최   병   남                                 │
 └──────┴───────────────────────┘
-----------------------------------------------------------------*/

#define		dfMain		1


/*---------------------------------------------------------------*/
/*     Header files                                              */
/*---------------------------------------------------------------*/
#include	<ecamsapi.h>
#include 	<ecams_util.h>

EXEC SQL INCLUDE "ecams_acct.h";


typedef struct
{
	short len;
	char  arr[100];
} vr;

/*---------------------------------------------------------------*/
/*       Oracle Sql Bind 변수 DEFINE                             */
/*---------------------------------------------------------------*/
EXEC SQL BEGIN DECLARE SECTION;
    EXEC SQL TYPE vr IS VARRAW(100);
    vr my_vr;
EXEC SQL END DECLARE SECTION;


#define DEBUG 1


/*---------------------------------------------------------------*/
/*       USER  PROCEDURE  DEFINE                                 */
/*---------------------------------------------------------------*/



/*---------------------------------------------------------------*/
/*		USER WORK DEFINE                                         */
/*---------------------------------------------------------------*/
char	gszRsultPath             [dfDir];




/*****************************************************************/
/*                                                               */
/*			형상관리의 버전소스 동기화 처리   M A I N            */
/*                                                               */
/*****************************************************************/
int		main (int argc, char **argv, char** envp)
{
char	szItemID              [dfItemID];
char	szUserID              [dfEditor];
char	SysCmd                     [256];
int 	retval                          ;
int		nPid                            ;


    if ( argc != 3 ) {
        printf ("usage : %s <프로그램등록번호> <사용자번호> \n", argv[0]);
        exit (0);
	}

	sprintf(szItemID, "%s", argv[1]);
	sprintf(szUserID, "%s", argv[2]);
	
	/*-----------------------------------------------------------*/
	/* 로그 파일 Set	        	  		                     */
	/*-----------------------------------------------------------*/
	Get_Sys_Date(gszLogFile);
	strcat(gszLogFile,".log");
	strcpy(gszLogPath,"LogMessage/");

	gEnvp = envp;				         /*### gEnvp = 환경변수  */
	nPid = getpid ();

	/*-----------------------------------------------------------*/
    /*   Signal Define			                                 */
    /*-----------------------------------------------------------*/
    DefineSignal ();

    /*-----------------------------------------------------------*/
    /*   eCAMS  DB Server  Connect                               */
    /*-----------------------------------------------------------*/
	if (ConnectDB() == FALSE)
		exit(1);

	/*-----------------------------------------------------------*/
    /*   Set Temp Directory                                      */
    /*-----------------------------------------------------------*/
	SetTempDir("99", gszTempPath);

	/*-----------------------------------------------------------*/
    /*   소스백업 디렉토리                                       */
    /*-----------------------------------------------------------*/
	SetTempDir("93", gszBackPath);


	/*-----------------------------------------------------------*/
    /*   소스 수작업 변경여부 조회                               */
    /*-----------------------------------------------------------*/

	sprintf(SysCmd, "ecams_diffck  %s %s PROD N", szItemID, szUserID);
	retval = system (SysCmd) / 256;
	if (retval == 9) {
		exit (retval);
	}
	
	if (retval != 0) {
		sprintf(SysCmd, "ecams_diffck  %s %s PROD Y", szItemID, szUserID);
		retval = system (SysCmd) / 256;		
	}
		
	EXEC SQL COMMIT WORK RELEASE;

	exit(retval);
}



/*---------------------------------------------------------------*/
/*             E N D    O F    P R O G R A M                     */
/*---------------------------------------------------------------*/

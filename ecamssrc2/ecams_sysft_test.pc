/*--------------------------------------------------------------
 ┌──────┬───────────────────────┐
 │ 프로그램명 │ ecams_sysft_test.pc                          │
 ├──────┼───────────────────────┤
 │ 기      능 │ eCAMS 신청자원의 처리                        │
 │            │ Check Out/Check In (Compile)                 │
 ├──────┼───────────────────────┤
 │ 작  성  일 │ 2011. 07. 10                                 │
 ├──────┼───────────────────────┤
 │ 작  성  자 │ 최   병   남                                 │
 └──────┴───────────────────────┘
-----------------------------------------------------------------*/

#define		dfMain		1


/*---------------------------------------------------------------*/
/*     Header files                                              */
/*---------------------------------------------------------------*/
#include	<ecamsapi.h>
#include 	<ecams_util.h>

EXEC SQL INCLUDE "ecams_acct.h";


typedef struct
{
	short len;
	char  arr[100];
} vr;

/*---------------------------------------------------------------*/
/*       Oracle Sql Bind 변수 DEFINE                             */
/*---------------------------------------------------------------*/
EXEC SQL BEGIN DECLARE SECTION;
    EXEC SQL TYPE vr IS VARRAW(100);
    vr my_vr;
EXEC SQL END DECLARE SECTION;


#define DEBUG 1


/*---------------------------------------------------------------*/
/*       USER  PROCEDURE  DEFINE                                 */
/*---------------------------------------------------------------*/



/*---------------------------------------------------------------*/
/*		USER WORK DEFINE                                         */
/*---------------------------------------------------------------*/
char	gszRsultPath             [dfDir];




/*****************************************************************/
/*                                                               */
/*			신청자원의 처리   M A I N                            */
/*                                                               */
/*****************************************************************/
int		main (int argc, char **argv, char** envp)
{
char	szAcptNo              [dfAcptNo]; /* eCAMS Log 접수번호  */
char	szJobID               [dfPrcSys]; /* 처리 구분           */
char	szRstCond            [dfRstCode]; /* 처리 결과 받을 변수 */
char	SysCmd                     [256];
int		nPid                            ;


    if ( argc != 3 ) {
        printf ("usage : %s <신청번호> <처리단계>\n", argv[0]);
        exit (0);
	}

	memset(szAcptNo , 0x00, sizeof(szAcptNo ));
    memset(szJobID  , 0x00, sizeof(szJobID  ));
    memset(szRstCond, 0x00, sizeof(szRstCond));

	/*-----------------------------------------------------------*/
	/* 로그 파일 Set	        	  		                     */
	/*-----------------------------------------------------------*/
	Get_Sys_Date(gszLogFile);
	strcat(gszLogFile,".log");
	strcpy(gszLogPath,"LogMessage/");

	/*-----------------------------------------------------------*/
	/* 	신청번호 , 시리얼번호 초기화	          			     */
	/*-----------------------------------------------------------*/
	sprintf(szAcptNo, "%s", argv[1]);     /* 접수번호         */
	gEnvp = envp;				         /*### gEnvp = 환경변수  */

	/*-----------------------------------------------------------*/
    /*   Signal Define			                                 */
    /*-----------------------------------------------------------*/
    DefineSignal ();

    /*-----------------------------------------------------------*/
    /*   eCAMS  DB Server  Connect                               */
    /*-----------------------------------------------------------*/
	if (ConnectDB() == FALSE)
		exit(1);

	/*-----------------------------------------------------------*/
    /*   Set Temp Directory                                      */
    /*-----------------------------------------------------------*/
	SetTempDir("99", gszTempPath);
	memset(szJobID, 0x00, sizeof(szJobID));
	sprintf(szJobID, "%s", argv[2]);

	/*-----------------------------------------------------------*/
    /*   소스백업 디렉토리                                       */
    /*-----------------------------------------------------------*/
	SetTempDir("93", gszBackPath);

	/*-----------------------------------------------------------*/
	/*	ResultFile Dir 체크                                      */
	/*-----------------------------------------------------------*/
	SetTempDir("11", gszRsultPath);
	Local_Dir_Make(gszRsultPath );

	nPid = getpid ();
	


	/*-----------------------------------------------------------*/
	/*	신청 구분별 처리					                     */
	/*-----------------------------------------------------------*/
	memset(szRstCond, 0x00, sizeof(szRstCond));
	if (strcmp(szJobID, "SYSFT") == 0) {
		Process_SYSFT(szAcptNo, szJobID, szRstCond);
	}

	else	
	if (strcmp(szJobID, "SYSPMD") == 0) {
		Process_SYSPMD(szAcptNo, szJobID, szRstCond);
	}
	
	else {
		printf("처리 단계 오류 : [%s]\n", szJobID);
	}

	EXEC SQL COMMIT WORK RELEASE;

	exit(0);
}



/*---------------------------------------------------------------*/
/*             E N D    O F    P R O G R A M                     */
/*---------------------------------------------------------------*/
